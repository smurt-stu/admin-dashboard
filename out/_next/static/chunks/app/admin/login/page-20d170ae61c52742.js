(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[116],{73687:(e,t,s)=>{Promise.resolve().then(s.bind(s,45630))},45630:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var o=s(95155),n=s(12115),r=s(76046),l=s(48173),a=s.n(l),c=s(77139);function i(){let[e,t]=(0,n.useState)({email:"",password:""}),[s,l]=(0,n.useState)(!1),[i,h]=(0,n.useState)(""),d=(0,r.useRouter)(),u=s=>{t({...e,[s.target.name]:s.target.value})},g=async t=>{t.preventDefault(),l(!0),h("");try{let t=await c.u.login(e);c.u.setTokens(t.access,t.refresh),d.push("/admin")}catch(e){h(e instanceof Error?e.message:"حدث خطأ في تسجيل الدخول")}finally{l(!1)}};return(0,o.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:(0,o.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,o.jsxs)("div",{className:"bg-white rounded-2xl shadow-xl p-8",children:[(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"mx-auto w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mb-4",children:(0,o.jsx)("i",{className:"ri-shield-user-fill text-white text-2xl"})}),(0,o.jsx)("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"تسجيل دخول المسؤول"}),(0,o.jsx)("p",{className:"text-gray-600",children:"أدخل بياناتك للوصول إلى لوحة التحكم"})]}),(0,o.jsxs)("form",{onSubmit:g,className:"mt-8 space-y-6",children:[(0,o.jsxs)("div",{className:"space-y-4",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"البريد الإلكتروني"}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{id:"email",name:"email",type:"email",required:!0,value:e.email,onChange:u,className:"appearance-none relative block w-full px-3 py-3 pr-10 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"admin@example.com"}),(0,o.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:(0,o.jsx)("i",{className:"ri-mail-line text-gray-400"})})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsx)("label",{htmlFor:"password",className:"block text-sm font-medium text-gray-700 mb-1",children:"كلمة المرور"}),(0,o.jsxs)("div",{className:"relative",children:[(0,o.jsx)("input",{id:"password",name:"password",type:"password",required:!0,value:e.password,onChange:u,className:"appearance-none relative block w-full px-3 py-3 pr-10 border border-gray-300 placeholder-gray-500 text-gray-900 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm",placeholder:"••••••••"}),(0,o.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:(0,o.jsx)("i",{className:"ri-lock-line text-gray-400"})})]})]})]}),i&&(0,o.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 flex items-center space-x-2 rtl:space-x-reverse",children:[(0,o.jsx)("i",{className:"ri-error-warning-fill text-red-500"}),(0,o.jsx)("span",{className:"text-red-700 text-sm",children:i})]}),(0,o.jsx)("div",{children:(0,o.jsx)("button",{type:"submit",disabled:s,className:"group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap cursor-pointer transition-colors",children:s?(0,o.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,o.jsx)("span",{children:"جاري تسجيل الدخول..."})]}):(0,o.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,o.jsx)("i",{className:"ri-login-box-line"}),(0,o.jsx)("span",{children:"تسجيل الدخول"})]})})}),(0,o.jsx)("div",{className:"text-center",children:(0,o.jsx)(a(),{href:"/",className:"text-sm text-blue-600 hover:text-blue-500 cursor-pointer",children:"العودة إلى المتجر"})})]})]}),(0,o.jsx)("div",{className:"text-center",children:(0,o.jsx)("p",{className:"text-xs text-gray-500",children:"محمي بواسطة نظام الأمان المتقدم"})})]})})}},77139:(e,t,s)=>{"use strict";s.d(t,{u:()=>n});let o="https://smart-ai-api.onrender.com/api/v1";class n{static async login(e){try{var t,s;console.log("\uD83D\uDD10 [AUTH] Starting login process...");let n=await fetch("".concat(o,"/auth/login/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok){let e=await n.json().catch(()=>({}));throw Error(e.message||"بيانات تسجيل الدخول غير صحيحة")}let r=await n.json();return console.log("\uD83D\uDD10 [AUTH] Login successful:",{hasAccessToken:!!r.access,hasRefreshToken:!!r.refresh,accessTokenLength:(null===(t=r.access)||void 0===t?void 0:t.length)||0,refreshTokenLength:(null===(s=r.refresh)||void 0===s?void 0:s.length)||0,userEmail:r.email||"N/A"}),r}catch(e){if(e instanceof Error)throw e;throw Error("حدث خطأ في الاتصال بالخادم")}}static getToken(){{let e=localStorage.getItem("access_token");return"undefined"===e||"null"===e?(console.log("\uD83E\uDDF9 [AUTH] Found corrupted access token, clearing..."),this.removeTokens(),null):(console.log("\uD83D\uDCD6 [AUTH] Retrieved access token:",{exists:!!e,length:(null==e?void 0:e.length)||0,isValid:e&&"undefined"!==e&&"null"!==e}),e)}}static getRefreshToken(){{let e=localStorage.getItem("refresh_token");return"undefined"===e||"null"===e?(console.log("\uD83E\uDDF9 [AUTH] Found corrupted refresh token, clearing..."),this.removeTokens(),null):(console.log("\uD83D\uDCD6 [AUTH] Retrieved refresh token:",{exists:!!e,length:(null==e?void 0:e.length)||0,isValid:e&&"undefined"!==e&&"null"!==e}),e)}}static setTokens(e,t){if(!e||!t||"undefined"===e||"undefined"===t||"null"===e||"null"===t){console.error("❌ [AUTH] Invalid tokens provided, cannot store");return}console.log("\uD83D\uDCBE [AUTH] Setting tokens:",{accessTokenLength:e.length,refreshTokenLength:t.length,accessTokenValid:3===e.split(".").length,refreshTokenValid:3===t.split(".").length}),localStorage.setItem("access_token",e),localStorage.setItem("refresh_token",t),console.log("✅ [AUTH] Tokens stored successfully")}static removeTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}static clearCorruptedTokens(){{let e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token");("undefined"===e||"undefined"===t||"null"===e||"null"===t)&&(console.log("\uD83E\uDDF9 [AUTH] Clearing corrupted tokens..."),this.removeTokens())}}static debugRawStorage(){{let e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token");console.log("\uD83D\uDDC4️ [AUTH] Raw localStorage contents:"),console.log("  - Raw access_token:",e),console.log("  - Raw refresh_token:",t),console.log("  - Access token type:",typeof e),console.log("  - Refresh token type:",typeof t)}}static debugTokenStatus(){let e=this.getToken(),t=this.getRefreshToken();if(console.log("\uD83D\uDD0D [AUTH DEBUG] Token Status:"),console.log("  - Access Token: ".concat(e?"Present":"Missing")),console.log("  - Refresh Token: ".concat(t?"Present":"Missing")),e){console.log("  - Access Token Details:",{length:e.length,start:e.substring(0,30),end:e.substring(e.length-10),hasJWTStructure:3===e.split(".").length,parts:e.split(".").length});try{let t=e.split(".");if(3!==t.length)console.log("  - Token is not in JWT format (should have 3 parts separated by dots)");else{let e=t[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),o=JSON.parse(s),n=Math.floor(Date.now()/1e3),r=o.exp-n;console.log("  - Access Token Expires: ".concat(new Date(1e3*o.exp).toLocaleString())),console.log("  - Time until expiry: ".concat(r," seconds")),console.log("  - Is Expired: ".concat(r<=0))}}catch(e){console.log("  - Could not decode access token:",e)}}if(t){console.log("  - Refresh Token Details:",{length:t.length,start:t.substring(0,30),end:t.substring(t.length-10),hasJWTStructure:3===t.split(".").length,parts:t.split(".").length});try{let e=t.split(".");if(3!==e.length)console.log("  - Refresh token is not in JWT format (should have 3 parts separated by dots)");else{let t=e[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),o=JSON.parse(s),n=Math.floor(Date.now()/1e3),r=o.exp-n;console.log("  - Refresh Token Expires: ".concat(new Date(1e3*o.exp).toLocaleString())),console.log("  - Time until expiry: ".concat(r," seconds")),console.log("  - Is Expired: ".concat(r<=0))}}catch(e){console.log("  - Could not decode refresh token:",e)}}}static isAuthenticated(){return!!this.getToken()}static async refreshToken(){let e=this.getRefreshToken();if(!e)return console.log("\uD83D\uDD04 [AUTH] No refresh token found"),!1;for(let t of(console.log("\uD83D\uDD04 [AUTH] Attempting to refresh token..."),[{url:"".concat(o,"/auth/token/refresh/"),body:{refresh:e}},{url:"".concat(o,"/auth/refresh/"),body:{refresh:e}},{url:"".concat(o,"/token/refresh/"),body:{refresh:e}},{url:"".concat(o,"/auth/jwt/refresh/"),body:{refresh:e}}]))try{console.log("\uD83D\uDD04 [AUTH] Trying refresh endpoint: ".concat(t.url)),console.log("\uD83D\uDD04 [AUTH] Request body:",t.body);let s=await fetch(t.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.body)});if(console.log("\uD83D\uDD04 [AUTH] Response status: ".concat(s.status)),s.ok){let t=await s.json();if(console.log("✅ [AUTH] Token refresh successful"),t.access&&t.refresh)this.setTokens(t.access,t.refresh);else if(t.access_token&&t.refresh_token)this.setTokens(t.access_token,t.refresh_token);else if(t.access)this.setTokens(t.access,e);else if(t.access_token)this.setTokens(t.access_token,e);else{console.error("\uD83D\uDD04 [AUTH] Unexpected response format:",t);continue}return!0}{let e=await s.json().catch(()=>({}));console.log("❌ [AUTH] Refresh failed with status ".concat(s.status,":"),e)}}catch(e){console.log("❌ [AUTH] Refresh attempt failed:",e)}return console.log("❌ [AUTH] All refresh attempts failed, removing tokens"),this.removeTokens(),!1}static async verifyToken(){let e=this.getToken();if(!e)return console.log("\uD83D\uDD0D [AUTH] No access token found"),!1;try{console.log("\uD83D\uDD0D [AUTH] Verifying access token...");let t=await fetch("".concat(o,"/auth/profile/"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(console.log("\uD83D\uDD0D [AUTH] Token verification response: ".concat(t.status)),401===t.status){if(console.log("\uD83D\uDD04 [AUTH] Access token expired, attempting refresh..."),await this.refreshToken()){console.log("✅ [AUTH] Token refreshed, retrying verification...");let e=this.getToken();if(e){let t=(await fetch("".concat(o,"/auth/profile/"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})).ok;return console.log("\uD83D\uDD0D [AUTH] Retry verification result: ".concat(t)),t}}return console.log("❌ [AUTH] Token refresh failed, removing tokens"),this.removeTokens(),!1}let s=t.ok;return console.log("✅ [AUTH] Token verification result: ".concat(s)),s}catch(e){return console.log("⚠️ [AUTH] Network error during token verification:",e),!0}}static logout(){this.removeTokens(),window.location.href="/admin/login"}static async makeAuthenticatedRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.getToken();if(!s)throw Error("لم يتم تسجيل الدخول");let o=await fetch(e,{...t,headers:{...t.headers,Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}});if(401===o.status){if(await this.refreshToken()){if(s=this.getToken()){if(401===(o=await fetch(e,{...t,headers:{...t.headers,Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}})).status)throw this.logout(),Error("انتهت صلاحية الجلسة")}else throw this.logout(),Error("انتهت صلاحية الجلسة")}else throw this.logout(),Error("انتهت صلاحية الجلسة")}return o}}},76046:(e,t,s)=>{"use strict";var o=s(66658);s.o(o,"usePathname")&&s.d(t,{usePathname:function(){return o.usePathname}}),s.o(o,"useRouter")&&s.d(t,{useRouter:function(){return o.useRouter}})}},e=>{var t=t=>e(e.s=t);e.O(0,[173,441,517,358],()=>t(73687)),_N_E=e.O()}]);