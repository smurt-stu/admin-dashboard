(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{97151:(e,t,s)=>{Promise.resolve().then(s.bind(s,13830))},13830:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>T});var a=s(95155),r=s(12115),o=s(10547),n=s(77139);let c="https://smart-ai-api.onrender.com/api/v1";class i{static async getUsers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1?arguments[1]:void 0,s=new URLSearchParams({page:e.toString(),...t&&{search:t}}),a=await n.u.makeAuthenticatedRequest("".concat(c,"/auth/admin/users/?").concat(s));if(!a.ok)throw Error("فشل في تحميل قائمة المستخدمين");return a.json()}static async getUserById(e){let t=await n.u.makeAuthenticatedRequest("".concat(c,"/auth/admin/users/").concat(e,"/"));if(!t.ok)throw Error("فشل في تحميل بيانات المستخدم");return t.json()}static async createUser(e){let t=await n.u.makeAuthenticatedRequest("".concat(c,"/auth/admin/users/"),{method:"POST",body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({}))).message||"فشل في إنشاء المستخدم");return t.json()}static async updateUser(e,t){let s=await n.u.makeAuthenticatedRequest("".concat(c,"/auth/admin/users/").concat(e,"/"),{method:"PATCH",body:JSON.stringify(t)});if(!s.ok)throw Error((await s.json().catch(()=>({}))).message||"فشل في تحديث المستخدم");return s.json()}static async deleteUser(e){if(!(await n.u.makeAuthenticatedRequest("".concat(c,"/auth/admin/users/").concat(e,"/"),{method:"DELETE"})).ok)throw Error("فشل في حذف المستخدم")}static async bulkAction(e){let t=await n.u.makeAuthenticatedRequest("".concat(c,"/auth/admin/bulk-actions/"),{method:"POST",body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json().catch(()=>({}))).message||"فشل في تنفيذ العملية")}static async resetPassword(e){if(!(await n.u.makeAuthenticatedRequest("".concat(c,"/auth/admin/users/").concat(e,"/reset-password/"),{method:"POST"})).ok)throw Error("فشل في إعادة تعيين كلمة المرور")}static getRoleDisplayName(e){return({admin:"مدير",staff:"موظف",user:"مستخدم",moderator:"مشرف",editor:"محرر"})[e]||e}static getStatusColor(e){return e?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}static getStatusText(e){return e?"نشط":"غير نشط"}}function l(){var e,t,s,n;let[c,l]=(0,r.useState)(null),[d,h]=(0,r.useState)(null),[u,g]=(0,r.useState)(!0),[p,m]=(0,r.useState)("");(0,r.useEffect)(()=>{f()},[]);let f=async()=>{try{g(!0);let[e,t]=await Promise.all([o.j.getDashboardAnalytics(),i.getUsers(1,"")]);l(e),h(t)}catch(e){m(e instanceof Error?e.message:"فشل في تحميل الإحصائيات")}finally{g(!1)}};if(u)return(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:Array.from({length:4}).map((e,t)=>(0,a.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200 animate-pulse",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded mb-2"}),(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded mb-2"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-20"})]}),(0,a.jsx)("div",{className:"w-12 h-12 bg-gray-200 rounded-full"})]})},t))});if(p)return(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center space-x-2 rtl:space-x-reverse",children:[(0,a.jsx)("i",{className:"ri-error-warning-fill text-red-500"}),(0,a.jsx)("span",{className:"text-red-700",children:p})]});let x=[{title:"إجمالي المنتجات",value:(null==c?void 0:null===(e=c.total_products)||void 0===e?void 0:e.toLocaleString("ar-SA"))||"0",change:(null==c?void 0:c.in_stock_products)?"".concat(Math.round(c.in_stock_products/c.total_products*100),"% متوفر"):"",icon:"ri-box-3-fill",color:"bg-blue-500",trend:"up"},{title:"المنتجات المتوفرة",value:(null==c?void 0:null===(t=c.in_stock_products)||void 0===t?void 0:t.toLocaleString("ar-SA"))||"0",change:(null==c?void 0:c.out_of_stock_products)?"".concat(c.out_of_stock_products," نفد المخزون"):"",icon:"ri-shopping-bag-fill",color:"bg-green-500",trend:"up"},{title:"إجمالي المستخدمين",value:(null==d?void 0:null===(s=d.count)||void 0===s?void 0:s.toLocaleString("ar-SA"))||"0",change:"عضو مسجل",icon:"ri-user-add-fill",color:"bg-purple-500",trend:"up"},{title:"مخزون منخفض",value:(null==c?void 0:null===(n=c.low_stock_products)||void 0===n?void 0:n.toLocaleString("ar-SA"))||"0",change:"منتج يحتاج تجديد",icon:"ri-alert-fill",color:(null==c?void 0:c.low_stock_products)&&c.low_stock_products>0?"bg-red-500":"bg-gray-500",trend:(null==c?void 0:c.low_stock_products)&&c.low_stock_products>0?"down":"up"}];return(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:x.map((e,t)=>(0,a.jsx)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.title}),(0,a.jsx)("h3",{className:"text-2xl font-bold text-gray-800",children:e.value}),(0,a.jsxs)("div",{className:"flex items-center mt-2",children:[(0,a.jsx)("i",{className:"ri-arrow-".concat(e.trend,"-line text-green-500 ml-1")}),(0,a.jsx)("span",{className:"text-sm text-green-500",children:e.change}),(0,a.jsx)("span",{className:"text-sm text-gray-500 mr-2",children:"من الشهر الماضي"})]})]}),(0,a.jsx)("div",{className:"".concat(e.color," p-3 rounded-full"),children:(0,a.jsx)("i",{className:"".concat(e.icon," text-white text-2xl")})})]})},t))})}var d=s(58581),h=s(24817),u=s(15255),g=s(12800),p=s(66963),m=s(27112),f=s(16161);function x(){return(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"إحصائيات المبيعات"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,a.jsx)("button",{className:"text-sm text-gray-500 hover:text-gray-700 cursor-pointer",children:"شهري"}),(0,a.jsx)("button",{className:"text-sm bg-blue-100 text-blue-600 px-3 py-1 rounded-full cursor-pointer",children:"أسبوعي"}),(0,a.jsx)("button",{className:"text-sm text-gray-500 hover:text-gray-700 cursor-pointer",children:"يومي"})]})]}),(0,a.jsx)(d.u,{width:"100%",height:300,children:(0,a.jsxs)(h.b,{data:[{name:"يناير",sales:12e3},{name:"فبراير",sales:19e3},{name:"مارس",sales:15e3},{name:"أبريل",sales:25e3},{name:"مايو",sales:22e3},{name:"يونيو",sales:3e4},{name:"يوليو",sales:28e3}],children:[(0,a.jsx)(u.d,{strokeDasharray:"3 3"}),(0,a.jsx)(g.W,{dataKey:"name"}),(0,a.jsx)(p.h,{}),(0,a.jsx)(m.m,{}),(0,a.jsx)(f.N,{type:"monotone",dataKey:"sales",stroke:"#3B82F6",strokeWidth:3})]})})]})}var y=s(48173),w=s.n(y);function k(){let e=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"shipped":return"bg-purple-100 text-purple-800";case"delivered":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-800",children:"الطلبات الأخيرة"}),(0,a.jsx)(w(),{href:"/admin/orders",className:"text-blue-600 hover:text-blue-700 text-sm font-medium cursor-pointer",children:"عرض جميع الطلبات"})]}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-200",children:[(0,a.jsx)("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"رقم الطلب"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"العميل"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"التاريخ"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"المبلغ"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"الحالة"}),(0,a.jsx)("th",{className:"text-right py-3 px-4 font-medium text-gray-600",children:"الإجراءات"})]})}),(0,a.jsx)("tbody",{children:[{id:"#ORD-001",customer:"أحمد محمد",date:"2024-01-15",total:"1,250 ريال",status:"pending",statusText:"في الانتظار"},{id:"#ORD-002",customer:"فاطمة علي",date:"2024-01-15",total:"890 ريال",status:"processing",statusText:"قيد التجهيز"},{id:"#ORD-003",customer:"محمد عبدالله",date:"2024-01-14",total:"2,150 ريال",status:"shipped",statusText:"تم الشحن"},{id:"#ORD-004",customer:"نورا سعد",date:"2024-01-14",total:"750 ريال",status:"delivered",statusText:"تم التسليم"},{id:"#ORD-005",customer:"خالد الأحمد",date:"2024-01-13",total:"1,890 ريال",status:"cancelled",statusText:"ملغي"}].map(t=>(0,a.jsxs)("tr",{className:"border-b border-gray-100 hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"py-4 px-4 font-medium text-blue-600",children:t.id}),(0,a.jsx)("td",{className:"py-4 px-4 text-gray-800",children:t.customer}),(0,a.jsx)("td",{className:"py-4 px-4 text-gray-600",children:t.date}),(0,a.jsx)("td",{className:"py-4 px-4 font-medium text-gray-800",children:t.total}),(0,a.jsx)("td",{className:"py-4 px-4",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(e(t.status)),children:t.statusText})}),(0,a.jsx)("td",{className:"py-4 px-4",children:(0,a.jsx)(w(),{href:"/admin/orders/".concat(t.id),className:"text-blue-600 hover:text-blue-700 text-sm cursor-pointer",children:"عرض التفاصيل"})})]},t.id))})]})})]})}function b(){return(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-sm border border-gray-200",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-6",children:"أفضل المنتجات مبيعاً"}),(0,a.jsx)("div",{className:"space-y-4",children:[{id:1,name:"سماعات لاسلكية",sales:1247,revenue:"24,580 ريال",image:"https://readdy.ai/api/search-image?query=wireless%20headphones%20product%20shot%20on%20clean%20white%20background%2C%20professional%20product%20photography%2C%20high%20quality%2C%20modern%20design&width=60&height=60&seq=1&orientation=squarish"},{id:2,name:"هاتف ذكي",sales:856,revenue:"85,600 ريال",image:"https://readdy.ai/api/search-image?query=smartphone%20product%20shot%20on%20clean%20white%20background%2C%20professional%20product%20photography%2C%20high%20quality%2C%20modern%20design&width=60&height=60&seq=2&orientation=squarish"},{id:3,name:"ساعة ذكية",sales:642,revenue:"32,100 ريال",image:"https://readdy.ai/api/search-image?query=smartwatch%20product%20shot%20on%20clean%20white%20background%2C%20professional%20product%20photography%2C%20high%20quality%2C%20modern%20design&width=60&height=60&seq=3&orientation=squarish"},{id:4,name:"حقيبة يد",sales:523,revenue:"15,690 ريال",image:"https://readdy.ai/api/search-image?query=handbag%20product%20shot%20on%20clean%20white%20background%2C%20professional%20product%20photography%2C%20high%20quality%2C%20modern%20design&width=60&height=60&seq=4&orientation=squarish"},{id:5,name:"كمبيوتر محمول",sales:387,revenue:"77,400 ريال",image:"https://readdy.ai/api/search-image?query=laptop%20computer%20product%20shot%20on%20clean%20white%20background%2C%20professional%20product%20photography%2C%20high%20quality%2C%20modern%20design&width=60&height=60&seq=5&orientation=squarish"}].map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 rtl:space-x-reverse",children:[(0,a.jsx)("img",{src:e.image,alt:e.name,className:"w-12 h-12 object-cover rounded-lg"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-800",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[e.sales," مبيع"]})]})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("p",{className:"font-bold text-gray-800",children:e.revenue})})]},e.id))})]})}function T(){return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-3xl font-bold text-gray-800",children:"لوحة القيادة"}),(0,a.jsx)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:(0,a.jsxs)("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center space-x-2 rtl:space-x-reverse whitespace-nowrap cursor-pointer",children:[(0,a.jsx)("i",{className:"ri-download-line"}),(0,a.jsx)("span",{children:"تصدير التقرير"})]})})]}),(0,a.jsx)(l,{}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,a.jsx)(x,{}),(0,a.jsx)(b,{})]}),(0,a.jsx)(k,{})]})}},77139:(e,t,s)=>{"use strict";s.d(t,{u:()=>r});let a="https://smart-ai-api.onrender.com/api/v1";class r{static async login(e){try{var t,s;console.log("\uD83D\uDD10 [AUTH] Starting login process...");let r=await fetch("".concat(a,"/auth/login/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!r.ok){let e=await r.json().catch(()=>({}));throw Error(e.message||"بيانات تسجيل الدخول غير صحيحة")}let o=await r.json();return console.log("\uD83D\uDD10 [AUTH] Login successful:",{hasAccessToken:!!o.access,hasRefreshToken:!!o.refresh,accessTokenLength:(null===(t=o.access)||void 0===t?void 0:t.length)||0,refreshTokenLength:(null===(s=o.refresh)||void 0===s?void 0:s.length)||0,userEmail:o.email||"N/A"}),o}catch(e){if(e instanceof Error)throw e;throw Error("حدث خطأ في الاتصال بالخادم")}}static getToken(){{let e=localStorage.getItem("access_token");return"undefined"===e||"null"===e?(console.log("\uD83E\uDDF9 [AUTH] Found corrupted access token, clearing..."),this.removeTokens(),null):(console.log("\uD83D\uDCD6 [AUTH] Retrieved access token:",{exists:!!e,length:(null==e?void 0:e.length)||0,isValid:e&&"undefined"!==e&&"null"!==e}),e)}}static getRefreshToken(){{let e=localStorage.getItem("refresh_token");return"undefined"===e||"null"===e?(console.log("\uD83E\uDDF9 [AUTH] Found corrupted refresh token, clearing..."),this.removeTokens(),null):(console.log("\uD83D\uDCD6 [AUTH] Retrieved refresh token:",{exists:!!e,length:(null==e?void 0:e.length)||0,isValid:e&&"undefined"!==e&&"null"!==e}),e)}}static setTokens(e,t){if(!e||!t||"undefined"===e||"undefined"===t||"null"===e||"null"===t){console.error("❌ [AUTH] Invalid tokens provided, cannot store");return}console.log("\uD83D\uDCBE [AUTH] Setting tokens:",{accessTokenLength:e.length,refreshTokenLength:t.length,accessTokenValid:3===e.split(".").length,refreshTokenValid:3===t.split(".").length}),localStorage.setItem("access_token",e),localStorage.setItem("refresh_token",t),console.log("✅ [AUTH] Tokens stored successfully")}static removeTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}static clearCorruptedTokens(){{let e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token");("undefined"===e||"undefined"===t||"null"===e||"null"===t)&&(console.log("\uD83E\uDDF9 [AUTH] Clearing corrupted tokens..."),this.removeTokens())}}static debugRawStorage(){{let e=localStorage.getItem("access_token"),t=localStorage.getItem("refresh_token");console.log("\uD83D\uDDC4️ [AUTH] Raw localStorage contents:"),console.log("  - Raw access_token:",e),console.log("  - Raw refresh_token:",t),console.log("  - Access token type:",typeof e),console.log("  - Refresh token type:",typeof t)}}static debugTokenStatus(){let e=this.getToken(),t=this.getRefreshToken();if(console.log("\uD83D\uDD0D [AUTH DEBUG] Token Status:"),console.log("  - Access Token: ".concat(e?"Present":"Missing")),console.log("  - Refresh Token: ".concat(t?"Present":"Missing")),e){console.log("  - Access Token Details:",{length:e.length,start:e.substring(0,30),end:e.substring(e.length-10),hasJWTStructure:3===e.split(".").length,parts:e.split(".").length});try{let t=e.split(".");if(3!==t.length)console.log("  - Token is not in JWT format (should have 3 parts separated by dots)");else{let e=t[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(e).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),a=JSON.parse(s),r=Math.floor(Date.now()/1e3),o=a.exp-r;console.log("  - Access Token Expires: ".concat(new Date(1e3*a.exp).toLocaleString())),console.log("  - Time until expiry: ".concat(o," seconds")),console.log("  - Is Expired: ".concat(o<=0))}}catch(e){console.log("  - Could not decode access token:",e)}}if(t){console.log("  - Refresh Token Details:",{length:t.length,start:t.substring(0,30),end:t.substring(t.length-10),hasJWTStructure:3===t.split(".").length,parts:t.split(".").length});try{let e=t.split(".");if(3!==e.length)console.log("  - Refresh token is not in JWT format (should have 3 parts separated by dots)");else{let t=e[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join("")),a=JSON.parse(s),r=Math.floor(Date.now()/1e3),o=a.exp-r;console.log("  - Refresh Token Expires: ".concat(new Date(1e3*a.exp).toLocaleString())),console.log("  - Time until expiry: ".concat(o," seconds")),console.log("  - Is Expired: ".concat(o<=0))}}catch(e){console.log("  - Could not decode refresh token:",e)}}}static isAuthenticated(){return!!this.getToken()}static async refreshToken(){let e=this.getRefreshToken();if(!e)return console.log("\uD83D\uDD04 [AUTH] No refresh token found"),!1;for(let t of(console.log("\uD83D\uDD04 [AUTH] Attempting to refresh token..."),[{url:"".concat(a,"/auth/token/refresh/"),body:{refresh:e}},{url:"".concat(a,"/auth/refresh/"),body:{refresh:e}},{url:"".concat(a,"/token/refresh/"),body:{refresh:e}},{url:"".concat(a,"/auth/jwt/refresh/"),body:{refresh:e}}]))try{console.log("\uD83D\uDD04 [AUTH] Trying refresh endpoint: ".concat(t.url)),console.log("\uD83D\uDD04 [AUTH] Request body:",t.body);let s=await fetch(t.url,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.body)});if(console.log("\uD83D\uDD04 [AUTH] Response status: ".concat(s.status)),s.ok){let t=await s.json();if(console.log("✅ [AUTH] Token refresh successful"),t.access&&t.refresh)this.setTokens(t.access,t.refresh);else if(t.access_token&&t.refresh_token)this.setTokens(t.access_token,t.refresh_token);else if(t.access)this.setTokens(t.access,e);else if(t.access_token)this.setTokens(t.access_token,e);else{console.error("\uD83D\uDD04 [AUTH] Unexpected response format:",t);continue}return!0}{let e=await s.json().catch(()=>({}));console.log("❌ [AUTH] Refresh failed with status ".concat(s.status,":"),e)}}catch(e){console.log("❌ [AUTH] Refresh attempt failed:",e)}return console.log("❌ [AUTH] All refresh attempts failed, removing tokens"),this.removeTokens(),!1}static async verifyToken(){let e=this.getToken();if(!e)return console.log("\uD83D\uDD0D [AUTH] No access token found"),!1;try{console.log("\uD83D\uDD0D [AUTH] Verifying access token...");let t=await fetch("".concat(a,"/auth/profile/"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}});if(console.log("\uD83D\uDD0D [AUTH] Token verification response: ".concat(t.status)),401===t.status){if(console.log("\uD83D\uDD04 [AUTH] Access token expired, attempting refresh..."),await this.refreshToken()){console.log("✅ [AUTH] Token refreshed, retrying verification...");let e=this.getToken();if(e){let t=(await fetch("".concat(a,"/auth/profile/"),{method:"GET",headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})).ok;return console.log("\uD83D\uDD0D [AUTH] Retry verification result: ".concat(t)),t}}return console.log("❌ [AUTH] Token refresh failed, removing tokens"),this.removeTokens(),!1}let s=t.ok;return console.log("✅ [AUTH] Token verification result: ".concat(s)),s}catch(e){return console.log("⚠️ [AUTH] Network error during token verification:",e),!0}}static logout(){this.removeTokens(),window.location.href="/admin/login"}static async makeAuthenticatedRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.getToken();if(!s)throw Error("لم يتم تسجيل الدخول");let a=await fetch(e,{...t,headers:{...t.headers,Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}});if(401===a.status){if(await this.refreshToken()){if(s=this.getToken()){if(401===(a=await fetch(e,{...t,headers:{...t.headers,Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}})).status)throw this.logout(),Error("انتهت صلاحية الجلسة")}else throw this.logout(),Error("انتهت صلاحية الجلسة")}else throw this.logout(),Error("انتهت صلاحية الجلسة")}return a}}},10547:(e,t,s)=>{"use strict";s.d(t,{j:()=>o});let a="https://smart-ai-api.onrender.com/api/v1";class r{async getAuthHeaders(){let e=localStorage.getItem("access_token");return{"Content-Type":"application/json",...e&&{Authorization:"Bearer ".concat(e)}}}async handleResponse(e){if(!e.ok){let t=await e.text();throw Error("HTTP ".concat(e.status,": ").concat(t))}return e.json()}async getStoreConstants(){let e=await fetch("".concat(a,"/store/core/constants/"));return this.handleResponse(e)}async getCategories(e){let t=new URLSearchParams;e&&Object.entries(e).forEach(e=>{let[s,a]=e;void 0!==a&&t.append(s,a.toString())});let s=await fetch("".concat(a,"/store/products/categories/?").concat(t),{headers:await this.getAuthHeaders()});return this.handleResponse(s)}async getCategoryTree(){let e=await fetch("".concat(a,"/store/products/categories/tree/"),{headers:await this.getAuthHeaders()});return this.handleResponse(e)}async getCategory(e){let t=await fetch("".concat(a,"/store/products/categories/").concat(e,"/"),{headers:await this.getAuthHeaders()});return this.handleResponse(t)}async createCategory(e){let t=await fetch("".concat(a,"/store/products/categories/"),{method:"POST",headers:await this.getAuthHeaders(),body:JSON.stringify(e)});return this.handleResponse(t)}async updateCategory(e,t){let s=await fetch("".concat(a,"/store/products/categories/").concat(e,"/"),{method:"PATCH",headers:await this.getAuthHeaders(),body:JSON.stringify(t)});return this.handleResponse(s)}async deleteCategory(e){let t=await fetch("".concat(a,"/store/products/categories/").concat(e,"/"),{method:"DELETE",headers:await this.getAuthHeaders()});if(!t.ok)throw Error("Failed to delete category: ".concat(t.statusText))}async getCategoryProducts(e,t){let s=new URLSearchParams;t&&Object.entries(t).forEach(e=>{let[t,a]=e;void 0!==a&&s.append(t,a.toString())});let r=await fetch("".concat(a,"/store/products/categories/").concat(e,"/products/?").concat(s),{headers:await this.getAuthHeaders()});return this.handleResponse(r)}async getProducts(e){let t=new URLSearchParams;e&&Object.entries(e).forEach(e=>{let[s,a]=e;void 0!==a&&t.append(s,a.toString())});let s=await fetch("".concat(a,"/store/products/products/?").concat(t),{headers:await this.getAuthHeaders()});return this.handleResponse(s)}async getProduct(e){let t=await fetch("".concat(a,"/store/products/products/").concat(e,"/"),{headers:await this.getAuthHeaders()});return this.handleResponse(t)}async createProduct(e){let t=await fetch("".concat(a,"/store/products/products/"),{method:"POST",headers:await this.getAuthHeaders(),body:JSON.stringify(e)});return this.handleResponse(t)}async updateProduct(e,t){let s=await fetch("".concat(a,"/store/products/products/").concat(e,"/"),{method:"PATCH",headers:await this.getAuthHeaders(),body:JSON.stringify(t)});return this.handleResponse(s)}async deleteProduct(e){let t=await fetch("".concat(a,"/store/products/products/").concat(e,"/"),{method:"DELETE",headers:await this.getAuthHeaders()});if(!t.ok)throw Error("Failed to delete product: ".concat(t.statusText))}async bulkUpdateProducts(e){let t=await fetch("".concat(a,"/store/products/products/bulk-update/"),{method:"POST",headers:await this.getAuthHeaders(),body:JSON.stringify({products:e})});return this.handleResponse(t)}async updateProductStock(e,t){let s=await fetch("".concat(a,"/store/products/products/").concat(e,"/update-stock/"),{method:"POST",headers:await this.getAuthHeaders(),body:JSON.stringify(t)});return this.handleResponse(s)}async getFeaturedProducts(){let e=await fetch("".concat(a,"/store/products/products/featured/"),{headers:await this.getAuthHeaders()});return this.handleResponse(e)}async getBestSellers(){let e=await fetch("".concat(a,"/store/products/products/bestsellers/"),{headers:await this.getAuthHeaders()});return this.handleResponse(e)}async getNewArrivals(){let e=await fetch("".concat(a,"/store/products/products/new_arrivals/"),{headers:await this.getAuthHeaders()});return this.handleResponse(e)}async getOnSaleProducts(){let e=await fetch("".concat(a,"/store/products/products/on_sale/"),{headers:await this.getAuthHeaders()});return this.handleResponse(e)}async searchProducts(e,t){let s=new URLSearchParams({q:e});t&&Object.entries(t).forEach(e=>{let[t,a]=e;void 0!==a&&s.append(t,a.toString())});let r=await fetch("".concat(a,"/store/products/products/search/?").concat(s),{headers:await this.getAuthHeaders()});return this.handleResponse(r)}async getRelatedProducts(e){let t=await fetch("".concat(a,"/store/products/products/").concat(e,"/related/"),{headers:await this.getAuthHeaders()});return this.handleResponse(t)}async getProductImages(e){let t=new URLSearchParams;e&&t.append("product",e.toString());let s=await fetch("".concat(a,"/store/products/images/?").concat(t),{headers:await this.getAuthHeaders()});return this.handleResponse(s)}async uploadProductImage(e){let t=localStorage.getItem("access_token"),s=await fetch("".concat(a,"/store/products/images/"),{method:"POST",headers:{...t&&{Authorization:"Bearer ".concat(t)}},body:e});return this.handleResponse(s)}async updateProductImage(e,t){let s=await fetch("".concat(a,"/store/products/images/").concat(e,"/"),{method:"PATCH",headers:await this.getAuthHeaders(),body:JSON.stringify(t)});return this.handleResponse(s)}async deleteProductImage(e){let t=await fetch("".concat(a,"/store/products/images/").concat(e,"/"),{method:"DELETE",headers:await this.getAuthHeaders()});if(!t.ok)throw Error("Failed to delete image: ".concat(t.statusText))}async setMainProductImage(e){let t=await fetch("".concat(a,"/store/products/images/").concat(e,"/set_main/"),{method:"POST",headers:await this.getAuthHeaders()});return this.handleResponse(t)}async reorderProductImages(e){let t=await fetch("".concat(a,"/store/products/images/reorder/"),{method:"POST",headers:await this.getAuthHeaders(),body:JSON.stringify({orders:e})});return this.handleResponse(t)}async getAnalytics(e){let t=new URLSearchParams;e&&Object.entries(e).forEach(e=>{let[s,a]=e;void 0!==a&&t.append(s,a.toString())});let s=await fetch("".concat(a,"/store/products/analytics/?").concat(t),{headers:await this.getAuthHeaders()});return this.handleResponse(s)}async getDashboardAnalytics(){let e=await fetch("".concat(a,"/store/products/analytics/dashboard/"),{headers:await this.getAuthHeaders()});return this.handleResponse(e)}async getInventoryReport(){let e=await fetch("".concat(a,"/store/products/analytics/inventory-report/"),{headers:await this.getAuthHeaders()});return this.handleResponse(e)}async getCategoryAnalytics(e){let t=await fetch("".concat(a,"/store/products/categories/").concat(e,"/analytics/"),{headers:await this.getAuthHeaders()});return this.handleResponse(t)}}let o=new r}},e=>{var t=t=>e(e.s=t);e.O(0,[173,939,441,517,358],()=>t(97151)),_N_E=e.O()}]);