# ููุฎุต ุชุญุฏูุซ ูุธุงู ุฑูุน ุงูุตูุฑ - API Integration

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุญุฏูุซ ูุธุงู ุฑูุน ุงูุตูุฑ ูู ุตูุญุฉ ุชุนุฏูู ุงูููุชุฌ ููุชูุงูู ูุน API ุงููุทูุฑ ุงููุฐููุฑ ูู ุงูุชูุฑูุฑ `Frontend_Image_Upload_Guide.md`.

---

## ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ

### โ 1. ุชุญุฏูุซ API Endpoint

#### ูู:
```javascript
// API ูุญูู
const response = await fetch('/api/upload/image', {
  method: 'POST',
  body: formData
});
```

#### ุฅูู:
```javascript
// API ุงููุทูุฑ
const API_BASE_URL = 'https://smart-ai-api.onrender.com/api/v1/store/products/';

const response = await fetch(`${API_BASE_URL}images/`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${accessToken}`
  },
  body: formData
});
```

### โ 2. ุชุญุฏูุซ ูููู ุงูุจูุงูุงุช

#### ุงูุญููู ุงููุทููุจุฉ ุญุณุจ API ุงููุทูุฑ:
```javascript
formData.append('product', productId);
formData.append('image', file);
```

#### ุงูุญููู ุงูุงุฎุชูุงุฑูุฉ:
```javascript
formData.append('image_type', 'gallery');
formData.append('alt_text', JSON.stringify({
  ar: 'ุงููุต ุงูุจุฏูู ุจุงูุนุฑุจู',
  en: 'Alt text in English'
}));
formData.append('caption', JSON.stringify({
  ar: 'ูุตู ุงูุตูุฑุฉ ุจุงูุนุฑุจู',
  en: 'Image caption in English'
}));
formData.append('display_order', '1');
formData.append('is_primary', 'false');
```

### โ 3. ุฅุถุงูุฉ ุฎุฏูุฉ ProductImageService

#### ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:
- โ ุงูุชุญูู ูู ุตุญุฉ ุงููููุงุช
- โ ุฑูุน ุงูุตูุฑ ูุน ุฏุนู ูุชุนุฏุฏ ุงููุบุงุช
- โ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
- โ ุฏุนู ุฃููุงุน ุงูุตูุฑ ุงููุฎุชููุฉ (main, gallery, thumbnail, variant)

#### ูุซุงู ุงูุงุณุชุฎุฏุงู:
```javascript
const result = await ProductImageService.uploadImage(
  productId,
  file,
  {
    imageType: 'gallery',
    altText: {
      ar: 'ุตูุฑุฉ ุงูููุชุฌ',
      en: 'Product Image'
    },
    caption: {
      ar: 'ุตูุฑุฉ ุชูุตูููุฉ ููููุชุฌ',
      en: 'Detailed product image'
    },
    displayOrder: 1,
    isPrimary: false
  }
);
```

### โ 4. ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

#### ุฑููุฒ ุงูุฃุฎุทุงุก ุงููุฏุนููุฉ:
- `400` - ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ
- `401` - ุบูุฑ ูุตุฑุญ (ูุญุชุงุฌ ุชุณุฌูู ุฏุฎูู)
- `403` - ููุณ ูุฏูู ุตูุงุญูุฉ
- `404` - ุงูููุชุฌ ุบูุฑ ููุฌูุฏ
- `413` - ุญุฌู ุงูููู ูุจูุฑ ุฌุฏุงู
- `415` - ููุน ุงูููู ุบูุฑ ูุฏุนูู
- `500` - ุฎุทุฃ ูู ุงูุฎุงุฏู

#### ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก:
```javascript
static handleError(error: any): string {
  let errorMessage = 'ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน';
  
  if (error.response) {
    const status = error.response.status;
    
    switch (status) {
      case 400:
        errorMessage = 'ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ - ุชุฃูุฏ ูู ุตุญุฉ ุงูููู';
        break;
      case 401:
        errorMessage = 'ุบูุฑ ูุตุฑุญ ูู ุจุฑูุน ุงูุตูุฑ - ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ููุฏูุฑ';
        break;
      // ... ุจุงูู ุงูุญุงูุงุช
    }
  }
  
  return errorMessage;
}
```

### โ 5. ุชุญุณูู ุงูุชุญูู ูู ุงููููุงุช

#### ุงูุฃููุงุน ุงููุฏุนููุฉ:
- JPG / JPEG
- PNG
- GIF
- WEBP

#### ุญุฏูุฏ ุงูุญุฌู:
- ุงูุญุฏ ุงูุฃูุตู: 5MB ููู ุตูุฑุฉ
- ุงูุญุฏ ุงูุฃุฏูู: ูุง ููุฌุฏ

#### ุงูุชุญูู ูู ุงูุฃุจุนุงุฏ:
```javascript
static validateImageFile(file: File): string[] {
  const errors: string[] = [];
  
  // ุงูุชุญูู ูู ููุน ุงูููู
  const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
  if (!allowedTypes.includes(file.type)) {
    errors.push('ููุน ุงูููู ุบูุฑ ูุฏุนูู. ุงูุฃููุงุน ุงููุฏุนููุฉ: JPG, PNG, GIF, WEBP');
  }
  
  // ุงูุชุญูู ูู ุญุฌู ุงูููู (5MB)
  const maxSize = 5 * 1024 * 1024;
  if (file.size > maxSize) {
    errors.push('ุญุฌู ุงูููู ูุจูุฑ ุฌุฏุงู. ุงูุญุฏ ุงูุฃูุตู: 5MB');
  }
  
  return errors;
}
```

---

## ุงููููุงุช ุงููุญุฏุซุฉ

### 1. `app/admin/products/[id]/edit/components/MediaTab.tsx`
- โ ุฅุถุงูุฉ ProductImageService ูุจุงุดุฑุฉ ูู ุงูููู
- โ ุชุญุฏูุซ ูุธููุฉ ุฑูุน ุงูุตูุฑ ูุงุณุชุฎุฏุงู API ุงููุทูุฑ
- โ ุชุญุณูู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก
- โ ุฅุถุงูุฉ ุฏุนู ูุชุนุฏุฏ ุงููุบุงุช ูููุตูุต ุงูุจุฏููุฉ

### 2. `lib/products/imageService.ts`
- โ ุฅูุดุงุก ุฎุฏูุฉ ูููุตูุฉ ูุฅุฏุงุฑุฉ ุงูุตูุฑ
- โ ุฏุนู ุฌููุน ุนูููุงุช API ุงููุทูุฑ
- โ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
- โ ุงูุชุญูู ูู ุตุญุฉ ุงููููุงุช

---

## ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ

### ๐ฏ 1. ุฏุนู ูุชุนุฏุฏ ุงููุบุงุช
```javascript
altText: {
  ar: 'ุตูุฑุฉ ุงูููุชุฌ',
  en: 'Product Image'
},
caption: {
  ar: 'ุตูุฑุฉ ุชูุตูููุฉ ููููุชุฌ',
  en: 'Detailed product image'
}
```

### ๐ฏ 2. ุฃููุงุน ุงูุตูุฑ ุงููุฎุชููุฉ
- `main` - ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ
- `gallery` - ุตูุฑ ุงููุนุฑุถ
- `thumbnail` - ุงูุตูุฑุฉ ุงููุตุบุฑุฉ
- `variant` - ุตูุฑุฉ ูุชุบูุฑ ุงูููุชุฌ

### ๐ฏ 3. ุฅุฏุงุฑุฉ ุชุฑุชูุจ ุงูุตูุฑ
```javascript
displayOrder: 1  // ุชุฑุชูุจ ุงูุตูุฑุฉ ูู ุงููุนุฑุถ
```

### ๐ฏ 4. ุชุนููู ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ
```javascript
isPrimary: true  // ุชุนููู ูุตูุฑุฉ ุฑุฆูุณูุฉ
```

---

## ููููุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุฑูุน ุตูุฑุฉ ุฌุฏูุฏุฉ:
```javascript
const result = await ProductImageService.uploadImage(
  productId,
  file,
  {
    imageType: 'gallery',
    altText: { ar: 'ุตูุฑุฉ ุงูููุชุฌ', en: 'Product Image' },
    caption: { ar: 'ูุตู ุงูุตูุฑุฉ', en: 'Image description' },
    displayOrder: 1,
    isPrimary: false
  }
);
```

### 2. ุฌูุจ ุตูุฑ ุงูููุชุฌ:
```javascript
const images = await ProductImageService.getProductImages(productId);
```

### 3. ุชุนููู ุตูุฑุฉ ุฑุฆูุณูุฉ:
```javascript
await ProductImageService.setMainImage(imageId);
```

### 4. ุญุฐู ุตูุฑุฉ:
```javascript
await ProductImageService.deleteImage(imageId);
```

---

## ุงูุชูุงูู ูุน API ุงููุทูุฑ

### โ Base URL:
```
https://smart-ai-api.onrender.com/api/v1/store/products/
```

### โ Authentication:
```javascript
headers: {
  'Authorization': `Bearer ${accessToken}`
}
```

### โ Endpoints ุงููุฏุนููุฉ:
- `POST /images/` - ุฑูุน ุตูุฑุฉ ุฌุฏูุฏุฉ
- `GET /images/?product={id}` - ุฌูุจ ุตูุฑ ุงูููุชุฌ
- `GET /images/{id}/` - ุฌูุจ ุชูุงุตูู ุตูุฑุฉ
- `PUT /images/{id}/` - ุชุญุฏูุซ ุตูุฑุฉ
- `DELETE /images/{id}/` - ุญุฐู ุตูุฑุฉ
- `POST /images/{id}/set-main/` - ุชุนููู ูุตูุฑุฉ ุฑุฆูุณูุฉ
- `POST /images/reorder/` - ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูุตูุฑ

---

## ุงููุชุงุฆุฌ

### โ ูุง ุชู ุฅูุฌุงุฒู:
1. **ุชูุงูู ูุงูู ูุน API ุงููุทูุฑ**
2. **ุฏุนู ูุชุนุฏุฏ ุงููุบุงุช ูููุตูุต ุงูุจุฏููุฉ**
3. **ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก**
4. **ุชุญูู ูู ุตุญุฉ ุงููููุงุช**
5. **ุฏุนู ุฃููุงุน ุงูุตูุฑ ุงููุฎุชููุฉ**
6. **ุฅุฏุงุฑุฉ ุชุฑุชูุจ ุงูุตูุฑ**
7. **ุชุนููู ุงูุตูุฑุฉ ุงูุฑุฆูุณูุฉ**

### ๐ฏ ุงูููุงุฆุฏ:
- **ุฃูุงู ุนุงูู** - ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูุงููููุงุช
- **ุฃุฏุงุก ุฌูุฏ** - ุฑูุน ูุชูุงุฒู ููุตูุฑ
- **ุชุฌุฑุจุฉ ูุณุชุฎุฏู ูุญุณูุฉ** - ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- **ูุงุจููุฉ ุงูุชูุณุน** - ุฏุนู ุฃููุงุน ูุฎุชููุฉ ูู ุงูุตูุฑ
- **ุชูุงูู ูุน ุงููุนุงููุฑ** - API RESTful ุงุญุชุฑุงูู

---

## ููุงุญุธุงุช ูููุฉ

### ๐ ุงูุฃูุงู:
- ุฌููุน ุงูุนูููุงุช ุชุชุทูุจ ูุตุงุฏูุฉ ูุฏูุฑ
- ุงูุชุญูู ูู ููุน ูุญุฌู ุงููููุงุช
- ูุนุงูุฌุฉ ุขููุฉ ููุฃุฎุทุงุก

### ๐ฑ ุงูุชูุงูู:
- ุฏุนู ุฌููุน ุงููุชุตูุญุงุช ุงูุญุฏูุซุฉ
- ุฏุนู ุงูุณุญุจ ูุงูุฅููุงุช
- ุฑูุน ูุชุนุฏุฏ ููุตูุฑ

### ๐ ุงูุฃุฏุงุก:
- ุฑูุน ูุชูุงุฒู ููุตูุฑ
- ูุคุดุฑ ุชูุฏู ุงูุฑูุน
- ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก ุฏูู ุชููู ุงูุนูููุฉ

---

## ุงูุฎูุงุตุฉ

ุชู ุชุญุฏูุซ ูุธุงู ุฑูุน ุงูุตูุฑ ุจูุฌุงุญ ููุชูุงูู ูุน API ุงููุทูุฑ ุงููุฐููุฑ ูู ุงูุชูุฑูุฑ. ุงููุธุงู ุงูุขู ูุฏุนู:

- โ ุฑูุน ุงูุตูุฑ ุงููุนููุฉ ูู ุงูููุจููุชุฑ
- โ ุฏุนู ุงูุณุญุจ ูุงูุฅููุงุช
- โ ุฑูุน ูุชุนุฏุฏ ููุตูุฑ
- โ ุฏุนู ูุชุนุฏุฏ ุงููุบุงุช
- โ ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก
- โ ุชูุงูู ูุงูู ูุน API ุงููุทูุฑ
- โ ุฃูุงู ุนุงูู ูุฃุฏุงุก ุฌูุฏ

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ูู ุงูุฅูุชุงุฌ ููุนูู ูุน Cloudflare R2 Storage!** ๐ 